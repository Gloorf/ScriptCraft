#!/bin/bash -xe

root=target/minecraft
rm -rf $root src/main/js/data
mkdir -p ${root}/config/worlds/default ${root}/plugins
cp target/scriptcraft.jar ${root}/plugins
cp test/templates/server.cfg ${root}/config/server.cfg
cp test/templates/world.cfg  ${root}/config/worlds/default/default_NORMAL.cfg
cp -u target/lib/canarymod.jar ${root}

docker run -it --rm -p 25595:25565 \
  -v $PWD/${root}:/server \
  $DEVARGS \
  -w /server \
  -u $(id -u):$(id -g) \
  --name=scriptcraft-canarymod-test \
  -v $(perl -MCwd=realpath -e "print realpath 'src/main/js'"):/server/scriptcraft \
  java:8 bash -c "echo eula=true > eula.txt ; java -jar canarymod.jar nocontrol"
